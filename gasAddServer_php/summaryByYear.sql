Create View
`summaryByYear` AS
(select `a`.`DYear` AS `DYear`,`a`.`currentMile` AS `currentmile`,(case when isnull(`b`.`currentMile`) then `a`.`currentMile` else (`a`.`currentMile` - `b`.`currentMile`) end) AS `mile`,round(`a`.`totalGallon`,3) AS `gallon`,round(((case when isnull(`b`.`currentMile`) then `a`.`currentMile` else (`a`.`currentMile` - `b`.`currentMile`) end) / `a`.`totalGallon`),2) AS `mpg`,`a`.`totalMoney` AS `total`,round(((case when isnull(`b`.`currentMile`) then `a`.`currentMile` else (`a`.`currentMile` - `b`.`currentMile`) end) / `a`.`totalMoney`),2) AS `mpd`,round((`a`.`totalMoney` / `a`.`totalGallon`),3) AS `avgPrice` from (`sqlwpblog`.`tempgroupbyyear` `a` left join `sqlwpblog`.`tempgroupbyyear` `b` on((`a`.`DYear` = (`b`.`DYear` + 1)))) order by `a`.`DYear` desc)